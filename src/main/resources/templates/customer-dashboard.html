<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <title>Customer Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/style.css">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"/>

  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Cinzel:wght@500;700&family=Lora:wght@400;500&display=swap" rel="stylesheet">

  <style>
    body {
	font-family: 'Playfair Display', serif;
      background: linear-gradient(135deg, #3d4180, #705540);
      color: #fff;
      min-height: 100vh;
	  display: flex;
	  flex-direction: column;

    }

	h2{
		text-align: center;
	}

    /* Background slideshow */
    .background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
    }

    .background img {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      transition: opacity 1s ease-in-out;
    }

    .background img.active {
      opacity: 1;
    }



    .dashboard-container {
      background: rgba(0, 0, 0, 0.7);
      margin: 5rem  auto;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
      max-width: 1200px;
    }

    .btn-primary, .btn-success, .btn-warning, .btn-danger {
      border-radius: 20px;
      padding: 8px 18px;
    }

    

  
    .modal-content {
      background: rgba(30,30,30,0.95);
      color: #fff;
      border-radius: 12px;
    }

    .form-control, .form-select {
      border-radius: 8px;
    }

    .alert-success {
      background: rgba(0,255,0,0.1);
      color: #90ee90;
      border: none;
    }

    .alert-danger {
      background: rgba(255,0,0,0.1);
      color: #ff8080;
      border: none;
    }
	.avaiavlableRooms{
		justify-content: center;

		display: flex;
	}
	form > div {
	  padding: 15px;
	  margin-bottom: 10px;
	  border-radius: 8px;
	  box-sizing: content-box;
	}
	table>:not(caption)>*>*{
		padding: .5rem .5rem;
		    color: var(--bs-table-color-state, var(--bs-table-color-type, #f7f1f1));
		    background-color: rgba(0, 0, 0, 0.6);
}
	#formInHorizon{
		flex-direction: row;
	}
	.modal-footer.d-flex {
	    display: flex !important;
	}
	.d-flex {
		
	}

	.btn {
		border-color: transparent !important;
	}
	.alert-info {
	    --bs-alert-color: #d6edf1 !important;
	    --bs-alert-bg: rgba(87 90 125 / 60%) !important;
	    --bs-alert-border-color: transparent !important ;
	    --bs-alert-link-color: var(--bs-info-text-emphasis);
	}
  </style>
</head>
<body>
  <!-- Background slideshow -->
  <div class="background">
    <img src="https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?w=1600" class="active">
    <img src="https://images.unsplash.com/photo-1748652252546-6bea5d896bd4?w=1600">
    <img src="https://images.unsplash.com/photo-1551882547-ff40c63fe5fa?w=1600">
    <img src="https://images.unsplash.com/photo-1744000311635-0280df5cc00e?w=1600">
  </div>

  <!-- Header -->
  <header>
    <nav>
      <a th:href="@{/home}"><i class="fas fa-home"></i> Home</a>
      <a th:href="@{/customer-dashboard}"><i class="fas fa-user"></i> Dashboard</a>
      <a th:href="@{/logout}"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </nav>
  </header>

  <!-- Dashboard Content -->
  <divd class="dashboard-container">
	<h2 class="mb-4">Welcome, <span th:text="${customer.customerName}"></span>!</h2>

    <!-- Success & Error messages -->
    <div th:if="${success}" class="alert alert-success mt-2" th:text="${success}"></div>
    <div th:if="${error}" class="alert alert-danger mt-2" th:text="${error}"></div>



   <!-- Available Rooms -->
    <h4 class="mt-4 mb-3">Available Rooms</h4>
	
	<div class="customer-dashboard">
    <form id="formInHorizon"  action="/customer-dashboard/rooms" method="get" class="row g-2 mb-4">
      <div class="col-md-3">
		<input type="date" name="checkInDate" class="form-control form-control-lg" th:min="${T(java.time.LocalDate).now()}" required>

      </div>
      <div class="col-md-3">
        <input type="date" name="checkOutDate" class="form-control form-control-lg" min="<?= LocalDate.now() ?>" required >
      </div>
      <div class="col-md-2">
        <button type="submit" class="book-btn  btn btn-primary btn-lg w-100 searchButton ">Search</button>
		
      </div>
    </form>
	</div>
	<div th:if="${searchPerformed}">
	    <!-- No Rooms Message -->
	    <div th:if="${noRoomsMessage}" class="alert alert-danger text-center" th:text="${noRoomsMessage}"></div>

	
	
 <div th:if="${availableRooms != null and !#lists.isEmpty(availableRooms)}">
      <table class="table table-hover align-middle text-white">
        <thead class="table-dark table thead">
          <tr>
            <th>Room Id</th>
            <th>Room Type</th>
            <th>Capacity</th>
            <th>Price per Day</th>
            <th>Description</th>
            <th>Ratings</th>
            <th>Book</th>
          </tr>
        </thead>
        <tbody class="table table_hover">
          <tr th:each="room : ${availableRooms}">
            <td th:text="${room.id}"></td>
            <td th:text="${room.roomType}"></td>
            <td th:text="${room.roomCapacity}"></td>
            <td th:text="${room.priceperDay}"></td>
            <td th:text="${room.description}"></td>
            <td th:text="${room.ratings}"></td>
            <td>
              <button type="button" class=" btn-primary btn btn-success btn-sm btnadmin"
                      th:data-bs-toggle="modal"
                      th:data-bs-target="'#bookModal__' + ${room.id}">
                Book
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Booking Modals -->
      <div th:each="room : ${availableRooms}">
        <div class="modal fade" th:id="'bookModal__' + ${room.id}" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <form th:action="@{/customer-dashboard/book}" method="post">
                <div class="modal-header">
                  <h5 class="modal-title">Book Room [[${room.roomType}]]</h5>
          
                </div>
                <div class="modal-body p-4">
                  <input type="hidden" name="roomId" th:value="${room.id}"/>
                  <div class="row mb-3">
                    <div class="col">
                      <label>Check-in Date:</label>
                      <input type="date" name="checkInDate" th:attr="min=${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}" required />
                    </div>
                    <div class="col">
                      <label>Check-out Date:</label><input type="date" name="checkOutDate" th:attr="min=${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}" required /></div>
                  </div>
                  <div class="mb-3">
                    <span class="fw-bold text-primary">Price per Day:</span> <span th:text="${room.priceperDay}"></span>
                  </div>
                </div>
                <div class="modal-footer d-flex justify-content-end gap-2">
                  <button type="submit" class="btn btn-success btn-lg">Confirm Booking</button>
                  <button type="button" class="btn btn-secondary btn-lg" data-bs-dismiss="modal">Cancel</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
	</div>
    <!-- Bookings -->
	<h4 class="mt-5 mb-3">My Bookings</h4>

	<!-- Show message if no bookings -->
	<div th:if="${#lists.isEmpty(bookings)}" class="alert alert-info text-center">
	  üì≠ No bookings yet.
	</div>
    <table th:if="${!#lists.isEmpty(bookings)}" class="table table-hover align-middle text-white">
      <thead class="table-dark">
        <tr>
          <th>Room Type</th>
          <th>Check-in</th>
          <th>Check-out</th>
          <th>Total Price</th>
          <th>Status</th>
          <th>Booking Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="booking : ${bookings}" th:if="${booking.bookingStatusText != 'CANCELLED'}">
          <td th:text="${booking.room.roomType}"></td>
          <td th:text="${booking.checkInDate}"></td>
          <td th:text="${booking.checkOutDate}"></td>
          <td th:text="${booking.totalPrice}"></td>
		  <td>
		      <span th:if="${booking.bookingStatusText == 'PENDING'}" class="badge bg-warning text-dark">‚è≥ Awaiting Payment</span>
		      <span th:if="${booking.bookingStatusText == 'UPDATEREQUIRED'}" class="badge bg-info text-dark">‚ö† Update Required</span>
		      <span th:if="${booking.bookingStatusText == 'CONFIRMED'}" class="badge bg-primary">‚úî Booked</span>
		  </td>

          <td th:text="${booking.bookingDate}"></td>
          <td class="d-flex flex-column gap-2">
			<span th:if="${booking.paid and booking.bookingStatusText == 'CONFIRMED'}"
			        class="btn btn-success btn-sm disabled">‚úÖ Confirmed</span>
            <!-- Pay -->
            <button type="button" class="btn btn-success btn-sm"
                    th:if="${!booking.paid and booking.bookingStatus != 'CANCELLED'}"
                    data-bs-toggle="modal"
                    th:data-bs-target="'#payModal__' + ${booking.id}">
              Pay
            </button>

            <!-- Cancel -->
			<form th:if="${!booking.paid and booking.bookingStatusText != 'CANCELLED'}" 
			      action="/customer-dashboard/cancelBooking" method="post">
			  <input type="hidden" name="bookingId" th:value="${booking.id}"/>
			  <button type="submit" class="btn btn-danger btn-sm">Cancel</button>
			</form>




            <!-- Update -->
            <button type="button" class="btn btn-warning btn-sm"
                    th:if="${!booking.paid}"
                    data-bs-toggle="modal"
                    th:attr="data-bs-target=${'#updateModal__' + booking.id}">
              Update Booking
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Payment Modals -->
    <div th:each="booking : ${bookings}" th:if="${!booking.paid}">
      <div class="modal fade" th:id="'payModal__' + ${booking.id}" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <form th:action="@{/customer-dashboard/makePayment}" method="post">
              <div class="modal-header">
                <h5 class="modal-title">Make Payment</h5>
   
              </div>
              <div class="modal-body p-4">
                <input type="hidden" name="bookingId" th:value="${booking.id}"/>
                <div class="row mb-3">
                  <div class="col">
                    <label>Account Number:</label>
                    <input type="text" name="accountNumber" class="form-control form-control-lg" required/>
                  </div>
                  <div class="col">
                    <label>Balance:</label>
                    <input type="number" name="accountBalance" step="0.01" class="form-control form-control-lg" required/>
                  </div>
                </div>
                <div class="mb-3">
                  <label>Payment Method:</label>
                  <select name="method" class="form-select form-select-lg">
                    <option value="CASH">Cash</option>
                    <option value="ACCOUNT">Account</option>
                  </select>
                </div>
                <div class="mb-3 fw-bold text-primary">
                  Total to Pay: <span th:text="${booking.totalPrice}"></span>
                </div>
              </div>
              <div class="modal-footer d-flex justify-content-end gap-2">
                <button type="submit" class="btn btn-success btn-lg">Pay Now</button>
                <button type="button" class="btn btn-secondary btn-lg" data-bs-dismiss="modal">Cancel</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Update Booking Modals -->
    <div th:each="booking : ${bookings}" th:if="${!booking.paid}">
      <div class="modal fade" th:id="'updateModal__' + ${booking.id}" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <form th:action="@{/customer-dashboard/updateBooking}" method="post">
              <div class="modal-header">
                <h5 class="modal-title">Update Booking Dates</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body p-4">
                <input type="hidden" name="bookingId" th:value="${booking.id}" />
                <div class="row mb-3">
                  <div class="col">
                    <label>Check-in Date:</label>
                    <input type="date" name="checkInDate" th:value="${booking.checkInDate}" class="form-control form-control-lg" required/>
                  </div>
                  <div class="col">
                    <label>Check-out Date:</label>
                    <input type="date" name="checkOutDate" th:value="${booking.checkOutDate}" class="form-control form-control-lg" required/>
                  </div>
                </div>
              </div>
              <div class="modal-footer d-flex justify-content-end gap-2">
                <button type="submit" class="btn btn-warning btn-lg">Save Changes</button>
                <button type="button" class="btn btn-secondary btn-lg" data-bs-dismiss="modal">Cancel</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const images = document.querySelectorAll('.background img');
    let current = 0;

    setInterval(() => {
      images[current].classList.remove('active');
      current = (current + 1) % images.length;
      images[current].classList.add('active');
    }, 4000);
  </script>
</body>
</html>
